(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2cfb7329"],{"06c5":function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));a("fb6a"),a("d3b7"),a("b0c0"),a("a630"),a("3ca3"),a("ac1f"),a("00b4");var r=a("6b75");function s(t,e){if(t){if("string"===typeof t)return Object(r["a"])(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(r["a"])(t,e):void 0}}},"1d56":function(t,e,a){},"1e95":function(t,e,a){"use strict";a("1d56")},2797:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("div",{staticClass:"modal show reply-modal",attrs:{tabindex:"-1",role:"dialog"},on:{click:function(e){return e.target!==e.currentTarget?null:t.close.apply(null,arguments)}}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("icon",{staticClass:"icon-close cursor-pointer",attrs:{"icon-name":"cross"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.close.apply(null,arguments)}}})],1),a("div",{staticClass:"modal-body"},[a("section",{staticClass:"tweet-container"},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.tweet.userData?t.tweet.userData:{}}}),a("div",{staticClass:"vertical-bar"})],1),a("section",{staticClass:"content-part"},[a("div",{staticClass:"title-part"},[a("div",{staticClass:"user-name",attrs:{title:t.tweet.userData?t.emptyName(t.tweet.userData.name,t.tweet.userData.account):""}},[t._v(" "+t._s(t.tweet.userData?t.emptyName(t.tweet.userData.name,t.tweet.userData.account):"")+" ")]),a("div",{staticClass:"account-and-time"},[t._v(" "+t._s(t._f("addPrefix")(t.tweet.userData?t.tweet.userData.account:""))+"・"+t._s(t._f("timeFormat")(t.tweet.createdAt))+" ")])]),a("div",{staticClass:"description"},[t._v(" "+t._s(t.tweet.description)+" ")]),a("div",{staticClass:"reply-to"},[a("span",{staticClass:"text"},[t._v("回覆")]),a("span",{staticClass:"account"},[t._v(t._s(t._f("addPrefix")(t.tweet.userData?t.tweet.userData.account:"")))])])])]),a("section",{staticClass:"reply-input-box"},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.currentUser}})],1),a("section",{staticClass:"input-part"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim.lazy",value:t.comment,expression:"comment",modifiers:{trim:!0,lazy:!0}}],attrs:{placeholder:"推你的回覆",maxlength:"140"},domProps:{value:t.comment},on:{change:function(e){t.comment=e.target.value.trim()},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"control-part"},[a("span",{staticClass:"error-message",attrs:{title:"error"}},[t._v(t._s(t.error))]),a("button",{staticClass:"btn-control btn-reply",attrs:{disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.reply.apply(null,arguments)}}},[t._v(" 回覆 ")])])])])])])])]),a("div",{staticClass:"modal-backdrop show"})])])},s=[],n=a("1da1"),i=a("5530"),c=(a("96cf"),a("d9e2"),a("b0c0"),a("d092")),o=a("2708"),l=a("6783"),u=a("2f62"),p=a("2fa3"),d={components:{UserThumbnail:c["a"]},mixins:[o["c"],o["b"],o["a"],o["d"],o["e"]],props:{show:{type:Boolean,required:!0,default:!1},tweet:{type:Object,required:!0,default:function(){}}},data:function(){return{comment:"",error:"",isProcessing:!1}},computed:Object(i["a"])({},Object(u["b"])(["currentUser"])),methods:{reply:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,s,n,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.checkTweet(t.comment),r=a.status,s=a.message,t.error="",!1!==r){e.next=6;break}return t.error=s,e.abrupt("return");case 6:return t.isProcessing=!0,e.next=9,l["a"].postReply({tweetId:t.tweet.id,comment:t.comment});case 9:if(n=e.sent,c=n.data,"success"===c.status){e.next=13;break}throw new Error(c.message);case 13:t.$emit("after-reply",t.tweet.id),console.log(t.tweet),t.handleNewReply({id:(new Date).valueOf(),comment:t.comment,replyerData:Object(i["a"])({},t.currentUser),tweetId:(new Date).valueOf(),tweetOwnerId:t.tweet.userData.id,tweetOwnerAccount:t.tweet.userData.account,createdAt:new Date}),e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](0),p["a"].fire({icon:"error",title:"回覆失敗，請稍後再試"});case 21:return e.prev=21,t.isProcessing=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[0,18,21,24]])})))()},handleNewReply:function(t){var e=this.$route;"tweet"===e.name&&(this.$store.commit("produceReply",t),this.close()),this.close()},close:function(){this.comment="",this.error="",this.$emit("close")}}},f=d,m=(a("1e95"),a("2877")),v=Object(m["a"])(f,r,s,!1,null,"37f518cc",null);e["a"]=v.exports},2909:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var r=a("6b75");function s(t){if(Array.isArray(t))return Object(r["a"])(t)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function n(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var i=a("06c5");a("d9e2");function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t){return s(t)||n(t)||Object(i["a"])(t)||c()}},"2bad":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("portal",{attrs:{to:"modals"}},[a("ReplyModal",{attrs:{order:5,show:t.show,tweet:t.tweet},on:{"after-reply":function(e){return t.afterReplyHandler(e)},close:t.closeModal}})],1),a("SiteNav"),a("section",{staticClass:"main"},[a("section",{staticClass:"tweet-and-reply"},[a("div",{staticClass:"page-control"},[a("icon",{staticClass:"btn-back cursor-pointer",attrs:{"icon-name":"back-arrow"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$router.go(-1)}}}),a("span",{staticClass:"page-header"},[t._v(" 推文 ")])],1),a("main",{directives:[{name:"show",rawName:"v-show",value:!t.isLoadingTweet,expression:"!isLoadingTweet"}],staticClass:"tweet"},[a("div",{staticClass:"user-info"},[a("UserThumbnail",{attrs:{"initial-user":t.tweet.userData}}),a("span",{staticClass:"user"},[a("div",{staticClass:"name"},[t._v(t._s(t.emptyName(t.tweet.userData.name,t.tweet.userData.account)))]),a("div",{staticClass:"account"},[t._v(t._s(t._f("addPrefix")(t.tweet.userData.account)))])])],1),a("div",{staticClass:"description"},[t._v(" "+t._s(t.tweet.description)+" ")]),a("div",{staticClass:"time"},[t._v(" "+t._s(t._f("timeFormatForTweetPage")(t.tweet.createdAt))+" ")]),a("div",{staticClass:"breaker"}),a("div",{staticClass:"statistic"},[a("span",{staticClass:"reply"},[a("span",{staticClass:"count"},[t._v(" "+t._s(t._f("numberFormatEng")(t.tweet.replyAmount))+" ")]),a("span",{staticClass:"text"},[t._v(" 回覆 ")])]),a("span",{staticClass:"like"},[a("span",{staticClass:"count"},[t._v(" "+t._s(t._f("numberFormatEng")(t.tweet.likeAmount))+" ")]),a("span",{staticClass:"text"},[t._v(" 喜歡次數 ")])])]),a("div",{staticClass:"breaker"}),a("div",{staticClass:"control-group"},[a("icon",{staticClass:"control btn-reply cursor-pointer",attrs:{"icon-name":"reply"},nativeOn:{click:function(e){e.stopPropagation(),e.preventDefault(),t.show=!0}}}),t.tweet.userLiked?a("icon",{staticClass:"control btn-like cursor-pointer",attrs:{"icon-name":"like-checked"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.unlike(t.tweet.id)}}}):a("icon",{staticClass:"control btn-like cursor-pointer",attrs:{"icon-name":"like"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.like(t.tweet.id)}}})],1)]),a("section",{staticClass:"reply-section"},[a("div",{staticClass:"reply-list"},t._l(t.sortedReplies,(function(t){return a("Reply",{key:t.id,attrs:{"initial-reply":t}})})),1)])])]),a("RecommendedList")],1)},s=[],n=a("2909"),i=a("5530"),c=a("1da1"),o=(a("96cf"),a("d9e2"),a("99af"),a("2797")),l=a("2441"),u=a("44f5"),p=a("d092"),d=a("2f3e"),f=a("2fa3"),m=a("2708"),v=a("6783"),w={components:{ReplyModal:o["a"],SiteNav:l["a"],RecommendedList:u["a"],Reply:d["a"],UserThumbnail:p["a"]},mixins:[m["b"],m["a"],m["d"],m["e"]],data:function(){return{tweet:{id:-1,userData:{id:-1,account:"",name:"",avatar:""},description:"",replyAmount:0,likeAmount:0,userLiked:!1,createdAt:"2016-08-29T09:12:33.001+0000"},replies:[],isLoadingTweet:!0,isLOadingReplies:!0,isProcessing:!1,show:!1}},computed:{sortedReplies:function(){return Object(f["c"])(this.replies,"createdAt")}},watch:{"$store.state.messageQueue.reply":{handler:function(t,e){t&&void 0!==t.id&&(this.addReplyToList(t),this.$store.commit("consumeReply"))}}},created:function(){var t=this.$route.params.id;this.fetchTweet(t),this.fetchReplies(t)},beforeRouteUpdate:function(t,e,a){var r=t.params.id;this.fetchTweet(r),this.fetchReplies(r),a()},methods:{fetchTweet:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.isLoadingTweet=!0,a.prev=1,a.next=4,v["a"].get({tweetId:t});case 4:if(r=a.sent,"OK"===r.statusText){a.next=7;break}throw new Error(r.statusText);case 7:s=r.data,e.tweet=Object(i["a"])(Object(i["a"])({},e.tweet),s),e.isLoadingTweet=!1,a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](1),f["a"].fire({icon:"error",title:"無法取得推文資料，請稍後再試"});case 15:case"end":return a.stop()}}),a,null,[[1,12]])})))()},fetchReplies:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.isLOadingReplies=!0,a.prev=1,a.next=4,v["a"].getReplies({tweetId:t});case 4:if(r=a.sent,"OK"===r.statusText){a.next=7;break}throw new Error(r.statusText);case 7:e.replies=r.data,e.isLoadingTweet=!1,a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](1),f["a"].fire({icon:"error",title:"無法取得回覆資料，請稍後再試"});case 14:case"end":return a.stop()}}),a,null,[[1,11]])})))()},like:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.isProcessing){a.next=3;break}return f["a"].fire({icon:"warning",title:"請稍後再試"}),a.abrupt("return");case 3:return e.isProcessing=!0,a.prev=4,a.next=7,v["a"].like({tweetId:t});case 7:if(r=a.sent,s=r.data,"success"===s.status){a.next=11;break}throw new Error(s.message);case 11:e.tweet.userLiked=!0,e.tweet.likeAmount+=1,a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](4),f["a"].fire({icon:"error",title:"無法like推文，請稍後再試"});case 18:return a.prev=18,e.isProcessing=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[4,15,18,21]])})))()},unlike:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.isProcessing){a.next=3;break}return f["a"].fire({icon:"warning",title:"請稍後再試"}),a.abrupt("return");case 3:return e.isProcessing=!0,a.prev=4,a.next=7,v["a"].unlike({tweetId:t});case 7:if(r=a.sent,s=r.data,"success"===s.status){a.next=11;break}throw new Error(s.message);case 11:e.tweet.userLiked=!1,e.tweet.likeAmount-=1,a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](4),f["a"].fire({icon:"error",title:"無法unlike推文，請稍後再試"});case 18:return a.prev=18,e.isProcessing=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[4,15,18,21]])})))()},closeModal:function(){this.show=!1},afterReplyHandler:function(t){this.tweet.replyAmount=this.tweet.replyAmount+1},addReplyToList:function(t){this.replies=[t].concat(Object(n["a"])(this.replies))}}},h=w,b=(a("c7c8"),a("2877")),y=Object(b["a"])(h,r,s,!1,null,"02ac0760",null);e["default"]=y.exports},"2f3e":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reply-container"},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.reply.replyerData}})],1),a("section",{staticClass:"content-part"},[a("div",{staticClass:"title-part"},[a("div",{staticClass:"user-name",attrs:{title:t.emptyName(t.reply.replyerData.name,t.reply.replyerData.account)}},[t._v(" "+t._s(t.emptyName(t.reply.replyerData.name,t.reply.replyerData.account))+" ")]),a("div",{staticClass:"account-and-time"},[t._v(" "+t._s(t._f("addPrefix")(t.reply.replyerData.account))+"・"+t._s(t._f("timeFormat")(t.reply.createdAt))+" ")])]),a("div",{staticClass:"reply-to"},[a("span",{staticClass:"text"},[t._v("回覆")]),a("span",{staticClass:"account"},[t._v(t._s(t._f("addPrefix")(t.reply.tweetOwnerAccount)))])]),a("div",{staticClass:"reply"},[t._v(" "+t._s(t.reply.comment)+" ")])])])},s=[],n=a("5530"),i=a("d092"),c=a("2708"),o={components:{UserThumbnail:i["a"]},mixins:[c["b"],c["a"],c["d"],c["e"]],props:{initialReply:{type:Object,required:!0}},data:function(){return{reply:{}}},created:function(){this.reply=Object(n["a"])(Object(n["a"])({},this.reply),this.initialReply)}},l=o,u=(a("7628"),a("2877")),p=Object(u["a"])(l,r,s,!1,null,"7ae5b02e",null);e["a"]=p.exports},"4df4":function(t,e,a){"use strict";var r=a("da84"),s=a("0366"),n=a("c65b"),i=a("7b0b"),c=a("9bdd"),o=a("e95a"),l=a("68ee"),u=a("07fa"),p=a("8418"),d=a("9a1f"),f=a("35a1"),m=r.Array;t.exports=function(t){var e=i(t),a=l(this),r=arguments.length,v=r>1?arguments[1]:void 0,w=void 0!==v;w&&(v=s(v,r>2?arguments[2]:void 0));var h,b,y,g,C,k,_=f(e),x=0;if(!_||this==m&&o(_))for(h=u(e),b=a?new this(h):m(h);h>x;x++)k=w?v(e[x],x):e[x],p(b,x,k);else for(g=d(e,_),C=g.next,b=a?new this:[];!(y=n(C,g)).done;x++)k=w?c(g,v,[y.value,x],!0):y.value,p(b,x,k);return b.length=x,b}},"6b75":function(t,e,a){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}a.d(e,"a",(function(){return r}))},7628:function(t,e,a){"use strict";a("fab1")},"9bdd":function(t,e,a){var r=a("825a"),s=a("2a62");t.exports=function(t,e,a,n){try{return n?e(r(a)[0],a[1]):e(a)}catch(i){s(t,"throw",i)}}},a630:function(t,e,a){var r=a("23e7"),s=a("4df4"),n=a("1c7e"),i=!n((function(t){Array.from(t)}));r({target:"Array",stat:!0,forced:i},{from:s})},c7c8:function(t,e,a){"use strict";a("fea5")},fab1:function(t,e,a){},fea5:function(t,e,a){}}]);
//# sourceMappingURL=chunk-2cfb7329.b1d5343a.js.map